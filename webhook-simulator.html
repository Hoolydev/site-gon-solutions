<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Webhook - GON Solutions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #9333ea, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .simulator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .simulator-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chatwoot-icon {
            background: #1976d2;
            padding: 8px;
            border-radius: 8px;
        }
        
        .site-icon {
            background: #9333ea;
            padding: 8px;
            border-radius: 8px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #e5e7eb;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 14px;
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .btn {
            background: linear-gradient(45deg, #9333ea, #10b981);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(147, 51, 234, 0.3);
        }
        
        .response-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .response-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #10b981;
        }
        
        .response-content {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .placeholder-section {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .placeholder-title {
            color: #fbbf24;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .placeholder-code {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #fbbf24;
        }
        
        @media (max-width: 768px) {
            .simulator-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîó Simulador de Webhook</h1>
            <p>Teste os webhooks do Chatwoot e formul√°rio do site</p>
        </div>
        
        <div class="simulator-grid">
            <!-- Simulador Fluxo Alternativo -->
            <div class="simulator-card">
                <h2 class="card-title">
                    <span class="site-icon">üöÄ</span>
                    Fluxo Alternativo (Site)
                </h2>
                
                <div class="form-group">
                    <label>Nome do Cliente:</label>
                    <input type="text" id="alt-name" placeholder="Maria Santos" value="Maria Santos">
                </div>
                
                <div class="form-group">
                    <label>Empresa:</label>
                    <input type="text" id="alt-company" placeholder="Tech Corp" value="Tech Corp">
                </div>
                
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="text" id="alt-phone" placeholder="+5562888888888" value="+5562888888888">
                </div>
                
                <div class="form-group">
                    <label>Mensagem:</label>
                    <textarea id="alt-message" rows="3" placeholder="Gostaria de saber mais sobre...">Gostaria de saber mais sobre automa√ß√£o para minha empresa</textarea>
                </div>
                
                <div class="form-group">
                    <label>Tipo de Atendimento:</label>
                    <select id="alt-service">
                        <option value="vendas">Vendas</option>
                        <option value="suporte">Suporte</option>
                        <option value="consultoria">Consultoria</option>
                    </select>
                </div>
                
                <button class="btn" onclick="sendAlternativoWebhook()">üöÄ Testar Fluxo Alternativo</button>
                
                <div class="placeholder-section">
                    <div class="placeholder-title">üí° Formato do Fluxo Alternativo:</div>
                    <div class="placeholder-code">
// Estrutura esperada pelo fluxo<br>
{
&nbsp;&nbsp;"body": {<br>
&nbsp;&nbsp;&nbsp;&nbsp;"text": { "message": "{{MENSAGEM_FORMATADA}}" },<br>
&nbsp;&nbsp;&nbsp;&nbsp;"phone": "{{TELEFONE}}",<br>
&nbsp;&nbsp;&nbsp;&nbsp;"senderName": "{{NOME}}",<br>
&nbsp;&nbsp;&nbsp;&nbsp;"isEdit": false,<br>
&nbsp;&nbsp;&nbsp;&nbsp;"isGroup": false,<br>
&nbsp;&nbsp;&nbsp;&nbsp;"isNewsletter": false,<br>
&nbsp;&nbsp;&nbsp;&nbsp;"fromApi": false<br>
&nbsp;&nbsp;}<br>
}
                    </div>
                </div>
            </div>
            
            <!-- Simulador Chatwoot -->
            <div class="simulator-card">
                <h2 class="card-title">
                    <span class="chatwoot-icon">üí¨</span>
                    Webhook Chatwoot
                </h2>
                
                <div class="form-group">
                    <label>Nome do Cliente:</label>
                    <input type="text" id="chatwoot-name" placeholder="Jo√£o Silva" value="Jo√£o Silva">
                </div>
                
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="text" id="chatwoot-phone" placeholder="+5562999999999" value="+5562999999999">
                </div>
                
                <div class="form-group">
                    <label>Mensagem:</label>
                    <textarea id="chatwoot-message" rows="3" placeholder="Ol√°, preciso de ajuda...">Ol√°, preciso de informa√ß√µes sobre automa√ß√£o</textarea>
                </div>
                
                <div class="form-group">
                    <label>Tipo de Mensagem:</label>
                    <select id="chatwoot-type">
                        <option value="incoming">Incoming</option>
                        <option value="outgoing">Outgoing</option>
                    </select>
                </div>
                
                <button class="btn" onclick="sendChatwootWebhook()">üöÄ Enviar Webhook Chatwoot</button>
                
                <div class="placeholder-section">
                    <div class="placeholder-title">üí° Placeholder JavaScript:</div>
                    <div class="placeholder-code">
// Dados do Chatwoot<br>
const chatwootData = {<br>
&nbsp;&nbsp;nome: "{{CHATWOOT_SENDER_NAME}}",<br>
&nbsp;&nbsp;telefone: "{{CHATWOOT_PHONE}}",<br>
&nbsp;&nbsp;mensagem: "{{CHATWOOT_MESSAGE}}",<br>
&nbsp;&nbsp;tipo: "{{MESSAGE_TYPE}}"<br>
};
                    </div>
                </div>
            </div>
            
            <!-- Simulador Site -->
            <div class="simulator-card">
                <h2 class="card-title">
                    <span class="site-icon">üåê</span>
                    Webhook Site
                </h2>
                
                <div class="form-group">
                    <label>Nome:</label>
                    <input type="text" id="site-name" placeholder="Maria Santos" value="Maria Santos">
                </div>
                
                <div class="form-group">
                    <label>Empresa:</label>
                    <input type="text" id="site-company" placeholder="Tech Corp" value="Tech Corp">
                </div>
                
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="text" id="site-phone" placeholder="+5562888888888" value="+5562888888888">
                </div>
                
                <div class="form-group">
                    <label>Mensagem:</label>
                    <textarea id="site-message" rows="3" placeholder="Gostaria de saber mais sobre...">Gostaria de saber mais sobre automa√ß√£o para minha empresa</textarea>
                </div>
                
                <div class="form-group">
                    <label>Tipo de Atendimento:</label>
                    <select id="site-service">
                        <option value="vendas">Vendas</option>
                        <option value="suporte">Suporte</option>
                        <option value="consultoria">Consultoria</option>
                    </select>
                </div>
                
                <button class="btn" onclick="sendSiteWebhook()">üöÄ Enviar Webhook Site</button>
                
                <div class="placeholder-section">
                    <div class="placeholder-title">üí° Placeholder JavaScript:</div>
                    <div class="placeholder-code">
// Dados do Site<br>
const siteData = {<br>
&nbsp;&nbsp;nome: "{{SITE_CLIENT_NAME}}",<br>
&nbsp;&nbsp;empresa: "{{SITE_COMPANY}}",<br>
&nbsp;&nbsp;telefone: "{{SITE_PHONE}}",<br>
&nbsp;&nbsp;mensagem: "{{SITE_MESSAGE}}",<br>
&nbsp;&nbsp;tipoAtendimento: "{{SERVICE_TYPE}}"<br>
};
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Se√ß√£o de Resposta -->
        <div class="response-section">
            <h3 class="response-title">üì° Resposta do Webhook</h3>
            <div class="response-content" id="response-content">
                Aguardando envio de webhook...
            </div>
        </div>
    </div>
    
    <script>
        // URLs dos webhooks
        const WEBHOOK_URLS = {
            production: 'https://n8n.gonsolutions.site/webhook/sdrgon',
            test: 'https://n8n.gonsolutions.site/webhook-test/sdrgon',
            alternativo_prod: 'https://n8n.gonsolutions.site/webhook/site',
            alternativo_test: 'https://n8n.gonsolutions.site/webhook-test/site'
        };
        
        // Fun√ß√£o para enviar webhook do Chatwoot
        async function sendChatwootWebhook() {
            const name = document.getElementById('chatwoot-name').value;
            const phone = document.getElementById('chatwoot-phone').value;
            const message = document.getElementById('chatwoot-message').value;
            const messageType = document.getElementById('chatwoot-type').value;
            
            const messageId = Date.now();
            const conversationId = messageId + 1000;
            const contactId = Math.floor(Math.random() * 1000) + 100;
            
            const payload = {
                body: {
                    id: messageId,
                    account: {
                        id: 1,
                        name: "Gon Solutions"
                    },
                    content: message,
                    content_type: "text",
                    message_type: messageType,
                    created_at: Math.floor(Date.now() / 1000),
                    sender: {
                        id: contactId,
                        name: name,
                        phone_number: phone,
                        additional_attributes: {
                            fonte: "chatwoot_real"
                        }
                    },
                    conversation: {
                        id: conversationId,
                        inbox_id: 6,
                        labels: ["chatwoot-real"],
                        contact_inbox: {
                            id: contactId + 1000,
                            contact_id: contactId,
                            inbox_id: 6,
                            source_id: phone.replace("+55", "")
                        },
                        meta: {
                            sender: {
                                id: contactId,
                                name: name,
                                phone_number: phone
                            }
                        }
                    },
                    inbox: {
                        id: 6,
                        name: "Gonsolutions"
                    }
                }
            };
            
            await sendWebhook(payload, 'Chatwoot');
        }
        
        // Fun√ß√£o para enviar webhook do fluxo alternativo
        async function sendAlternativoWebhook() {
            const name = document.getElementById('alt-name').value;
            const company = document.getElementById('alt-company').value;
            const phone = document.getElementById('alt-phone').value;
            const message = document.getElementById('alt-message').value;
            const serviceType = document.getElementById('alt-service').value;
            
            const payload = {
                body: {
                    text: {
                        message: `üåê *Novo contato do site*\n\nüë§ *Nome:* ${name}\nüè¢ *Empresa:* ${company}\nüì± *Telefone:* ${phone}\nüìã *Tipo:* ${serviceType}\n\nüí¨ *Mensagem:*\n${message}`
                    },
                    phone: phone,
                    senderName: name,
                    isEdit: false,
                    isGroup: false,
                    isNewsletter: false,
                    fromApi: false
                }
            };
            
            await sendWebhookAlternativo(payload, 'Fluxo Alternativo');
        }
        
        // Fun√ß√£o para enviar webhook do site
        async function sendSiteWebhook() {
            const name = document.getElementById('site-name').value;
            const company = document.getElementById('site-company').value;
            const phone = document.getElementById('site-phone').value;
            const message = document.getElementById('site-message').value;
            const serviceType = document.getElementById('site-service').value;
            
            const messageId = Date.now();
            const conversationId = messageId + 1000;
            const contactId = Math.floor(Math.random() * 1000) + 100;
            
            const payload = {
                body: {
                    id: messageId,
                    account: {
                        id: 1,
                        name: "Gon Solutions"
                    },
                    content: `üåê *Novo contato do site*\n\nüë§ *Nome:* ${name}\nüè¢ *Empresa:* ${company}\nüì± *Telefone:* ${phone}\nüìã *Tipo:* ${serviceType}\n\nüí¨ *Mensagem:*\n${message}`,
                    content_type: "text",
                    message_type: "incoming",
                    created_at: Math.floor(Date.now() / 1000),
                    sender: {
                        id: contactId,
                        name: name,
                        phone_number: phone,
                        additional_attributes: {
                            empresa: company,
                            tipo_atendimento: serviceType,
                            fonte: "website_form"
                        }
                    },
                    conversation: {
                        id: conversationId,
                        inbox_id: 6,
                        labels: ["website-form", serviceType],
                        contact_inbox: {
                            id: contactId + 1000,
                            contact_id: contactId,
                            inbox_id: 6,
                            source_id: phone.replace("+55", "")
                        },
                        meta: {
                            sender: {
                                id: contactId,
                                name: name,
                                phone_number: phone
                            }
                        }
                    },
                    inbox: {
                        id: 6,
                        name: "Gonsolutions"
                    }
                },
                // Campos diretos para compatibilidade
                id: messageId,
                account: { id: 1, name: "Gon Solutions" },
                content: `üåê *Novo contato do site*\n\nüë§ *Nome:* ${name}\nüè¢ *Empresa:* ${company}\nüì± *Telefone:* ${phone}\nüìã *Tipo:* ${serviceType}\n\nüí¨ *Mensagem:*\n${message}`,
                message_type: "incoming",
                sender: {
                    phone_number: phone,
                    name: name
                },
                conversation: {
                    id: conversationId,
                    labels: ["website-form", serviceType]
                },
                created_at: Math.floor(Date.now() / 1000)
            };
            
            await sendWebhook(payload, 'Site');
        }
        
        // Fun√ß√£o espec√≠fica para enviar webhook do fluxo alternativo
        async function sendWebhookAlternativo(payload, source) {
            const responseDiv = document.getElementById('response-content');
            
            try {
                responseDiv.innerHTML = `üîÑ Enviando webhook ${source}...\n\nüì§ Payload:\n${JSON.stringify(payload, null, 2)}`;
                
                // Tenta primeiro a URL de produ√ß√£o do fluxo alternativo
                let response;
                try {
                    response = await fetch(WEBHOOK_URLS.alternativo_prod, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                } catch (error) {
                    // Se falhar, tenta a URL de teste do fluxo alternativo
                    console.log('Tentando URL de teste do fluxo alternativo...');
                    response = await fetch(WEBHOOK_URLS.alternativo_test, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                }
                
                const responseText = await response.text();
                
                responseDiv.innerHTML = `
‚úÖ Webhook ${source} enviado com sucesso!\n\nüìä Status: ${response.status} ${response.statusText}\n\nüì§ Payload Enviado:\n${JSON.stringify(payload, null, 2)}\n\nüì• Resposta:\n${responseText || 'Sem conte√∫do na resposta'}
                `;
                
            } catch (error) {
                responseDiv.innerHTML = `
‚ùå Erro ao enviar webhook ${source}:\n\nüö® Erro: ${error.message}\n\nüì§ Payload que tentou enviar:\n${JSON.stringify(payload, null, 2)}
                `;
            }
        }
        
        // Fun√ß√£o gen√©rica para enviar webhook
        async function sendWebhook(payload, source) {
            const responseDiv = document.getElementById('response-content');
            
            try {
                responseDiv.innerHTML = `üîÑ Enviando webhook ${source}...\n\nüì§ Payload:\n${JSON.stringify(payload, null, 2)}`;
                
                // Tenta primeiro a URL de produ√ß√£o
                let response;
                try {
                    response = await fetch(WEBHOOK_URLS.production, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                } catch (error) {
                    // Se falhar, tenta a URL de teste
                    console.log('Tentando URL de teste...');
                    response = await fetch(WEBHOOK_URLS.test, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });
                }
                
                const responseText = await response.text();
                
                responseDiv.innerHTML = `
‚úÖ Webhook ${source} enviado com sucesso!\n
üìä Status: ${response.status} ${response.statusText}\n\nüì§ Payload Enviado:\n${JSON.stringify(payload, null, 2)}\n\nüì• Resposta:\n${responseText || 'Sem conte√∫do na resposta'}
                `;
                
            } catch (error) {
                responseDiv.innerHTML = `
‚ùå Erro ao enviar webhook ${source}:\n\nüö® Erro: ${error.message}\n\nüì§ Payload que tentou enviar:\n${JSON.stringify(payload, null, 2)}
                `;
            }
        }
        
        // Fun√ß√£o para gerar placeholders din√¢micos
        function generatePlaceholders() {
            const placeholders = {
                chatwoot: {
                    '{{CHATWOOT_SENDER_NAME}}': document.getElementById('chatwoot-name').value,
                    '{{CHATWOOT_PHONE}}': document.getElementById('chatwoot-phone').value,
                    '{{CHATWOOT_MESSAGE}}': document.getElementById('chatwoot-message').value,
                    '{{MESSAGE_TYPE}}': document.getElementById('chatwoot-type').value
                },
                site: {
                    '{{SITE_CLIENT_NAME}}': document.getElementById('site-name').value,
                    '{{SITE_COMPANY}}': document.getElementById('site-company').value,
                    '{{SITE_PHONE}}': document.getElementById('site-phone').value,
                    '{{SITE_MESSAGE}}': document.getElementById('site-message').value,
                    '{{SERVICE_TYPE}}': document.getElementById('site-service').value
                }
            };
            
            return placeholders;
        }
        
        // Atualiza placeholders em tempo real
        document.addEventListener('input', function() {
            const placeholders = generatePlaceholders();
            console.log('Placeholders atualizados:', placeholders);
        });
        
        // Log inicial
        console.log('üîó Simulador de Webhook carregado!');
        console.log('URLs configuradas:', WEBHOOK_URLS);
    </script>
</body>
</html>